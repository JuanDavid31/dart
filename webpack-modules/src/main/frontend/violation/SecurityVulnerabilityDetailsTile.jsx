/*
 * Copyright (c) 2011-present Sonatype, Inc. All rights reserved.
 * Includes the third-party code listed at http://links.sonatype.com/products/clm/attributions.
 * "Sonatype" is a trademark of Sonatype, Inc.
 */
import React from 'react';
import * as PropTypes from 'prop-types';
import IqVulnerabilityDetails from 'MainRoot/react/IqVulnerabilityDetails/IqVulnerabilityDetails';
import LoadWrapper from '../react/LoadWrapper';
import { NxWarningAlert } from '@sonatype/react-shared-components';

export default function SecurityVulnerabilityDetailsTile({
  vulnerabilityDetails,
  error,
  loading,
  retryLoad,
  showTitle = true,
  componentName,
  isVulnerabilityDetailsOutdated,
  componentIdentifier,
  ownerType,
  ownerId,
  hasEditIqPermission,
  componentHash,
  tabId,
  repositoryId,
  matchState,
  pathname,
  isFirewall,
  isRepository,
}) {
  return (
    <div id="security-vulnerability-details-tile" data-testid="security-vulnerability-details-tile">
      {showTitle && (
        <div className="nx-tile-header">
          <div className="nx-tile-header__title">
            <h2 className="nx-h2">Security Vulnerability Details</h2>
          </div>
        </div>
      )}
      <div className="nx-tile-content">
        <LoadWrapper {...{ error, loading }} retryHandler={retryLoad}>
          {vulnerabilityDetails && (
            <IqVulnerabilityDetails
              componentName={componentName}
              vulnerabilityDetails={vulnerabilityDetails}
              componentIdentifier={componentIdentifier}
              ownerType={ownerType}
              ownerId={ownerId}
              showCustomizeButton={hasEditIqPermission}
              componentHash={componentHash}
              tabId={tabId}
              repositoryId={repositoryId}
              matchState={matchState}
              pathname={pathname}
              isFirewall={isFirewall}
              isRepository={isRepository}
            />
          )}
        </LoadWrapper>
        {isVulnerabilityDetailsOutdated && (
          <NxWarningAlert>
            This version of the violation report is outdated. Sonatype IQ Server has updated the vulnerability status
            for this and other related components. Run a new scan to detect the latest violations.
          </NxWarningAlert>
        )}
      </div>
    </div>
  );
}

SecurityVulnerabilityDetailsTile.propTypes = {
  isVulnerabilityDetailsOutdated: PropTypes.bool.isRequired,
  loading: PropTypes.bool.isRequired,
  error: LoadWrapper.propTypes.error,
  vulnerabilityDetails: PropTypes.oneOfType([
    IqVulnerabilityDetails.propTypes.vulnerabilityDetails,
    PropTypes.oneOf([null]),
  ]),
  retryLoad: PropTypes.func.isRequired,
  showTitle: PropTypes.bool,
  componentName: PropTypes.string,
  componentIdentifier: IqVulnerabilityDetails.propTypes.componentIdentifier,
  ownerType: IqVulnerabilityDetails.propTypes.ownerType,
  ownerId: IqVulnerabilityDetails.propTypes.ownerId,
  hasEditIqPermission: PropTypes.bool,
  componentHash: PropTypes.string,
  tabId: PropTypes.string,
  repositoryId: PropTypes.string,
  matchState: PropTypes.string,
  pathname: PropTypes.string,
  isFirewall: PropTypes.bool,
  isRepository: PropTypes.bool,
};
