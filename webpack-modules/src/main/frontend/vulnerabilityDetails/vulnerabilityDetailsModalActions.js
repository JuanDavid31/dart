/*
 * Copyright (c) 2011-present Sonatype, Inc. All rights reserved.
 * Includes the third-party code listed at http://links.sonatype.com/products/clm/attributions.
 * "Sonatype" is a trademark of Sonatype, Inc.
 */
import axios from 'axios';

import { noPayloadActionCreator, payloadParamActionCreator } from '../util/reduxUtil';
import { getVulnerabilityJsonDetailUrl } from '../util/CLMLocation';

export const OPEN_VULNERABILITY_DETAILS_MODAL = 'OPEN_VULNERABILITY_DETAILS_MODAL';
export const CLOSE_VULNERABILITY_DETAILS_MODAL = 'CLOSE_VULNERABILITY_DETAILS_MODAL';
export const FETCH_VULNERABILITY_DETAILS_FOR_MODAL_REQUESTED = 'FETCH_VULNERABILITY_DETAILS_FOR_MODAL_REQUESTED';
export const FETCH_VULNERABILITY_DETAILS_FOR_MODAL_FULFILLED = 'FETCH_VULNERABILITY_DETAILS_FOR_MODAL_FULFILLED';
export const FETCH_VULNERABILITY_DETAILS_FOR_MODAL_FAILED = 'FETCH_VULNERABILITY_DETAILS_FOR_MODAL_FAILED';

export const openVulnerabilityDetailsModal = payloadParamActionCreator(OPEN_VULNERABILITY_DETAILS_MODAL);
export const closeVulnerabilityDetailsModal = noPayloadActionCreator(CLOSE_VULNERABILITY_DETAILS_MODAL);
const requestVulnerabilityDetails = noPayloadActionCreator(FETCH_VULNERABILITY_DETAILS_FOR_MODAL_REQUESTED);
const loadVulnerabilityDetailsFulfilled = payloadParamActionCreator(FETCH_VULNERABILITY_DETAILS_FOR_MODAL_FULFILLED);
const loadVulnerabilityDetailsFailed = payloadParamActionCreator(FETCH_VULNERABILITY_DETAILS_FOR_MODAL_FAILED);

export function loadVulnerability(vulnerabilityId, componentIdentifier, extraQueryParameters) {
  return (dispatch) => {
    dispatch(requestVulnerabilityDetails());

    const url = getVulnerabilityJsonDetailUrl(vulnerabilityId, componentIdentifier, extraQueryParameters);

    return axios
      .get(url)
      .then((results) => dispatch(loadVulnerabilityDetailsFulfilled(results.data)))
      .catch((error) => dispatch(loadVulnerabilityDetailsFailed(error)));
  };
}
